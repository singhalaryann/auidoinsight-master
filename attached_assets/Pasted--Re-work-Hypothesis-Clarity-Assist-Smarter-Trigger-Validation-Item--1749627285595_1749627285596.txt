### **Re-work: Hypothesis Clarity Assist ‚Äî Smarter Trigger & Validation**

| Item                      | Revised Detail                                                                                                                                                                                                                                                                                                                         |                                                |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------- |
| **Trigger**               | On **Next ‚Ä¢ Variants & Traffic**, backend calls **`POST /ai/hypothesis-score`** regardless of length. Assist modal appears when \*\*`quality_score < 0.80` \*\* *or* any **required component** is missing (see rule set below).                                                                                                       |                                                |
| **Rule Set (LLM prompt)** | Ask GPT-4o to extract: <br>‚Ä¢ **Population** (who) <br>‚Ä¢ **Action / Change** (what) <br>‚Ä¢ **Metric** (measure) <br>‚Ä¢ **Direction** (increase / decrease) <br>‚Ä¢ **Timeframe** (D1, week, etc.) <br>Return `{components_found[], quality_score}` where score = (#found √∑ 5).                                                              |                                                |
| **API Contract**          | **`POST /ai/hypothesis-score`**<br>Req: `{ "text": "<user hypothesis>" }`<br>Resp:  `{ "quality_score": 0-1, "missing": ["Metric","Direction"] }`                                                                                                                                                                                      |                                                |
| **UI (Modal)**            | Title: **‚ÄúLet‚Äôs sharpen your hypothesis‚Äù** <br>Sub: *‚ÄúMissing pieces: Metric, Direction. Pick a suggested version or refine manually.‚Äù* <br>Suggestions list (‚â§ 3) crafted by GPT-4o <br>‚úî **Use Suggestion** ‚Üí replaces text <br>üìù **Edit Manually** ‚Üí cursor focus on textarea <br>Skip link: **Keep Original** (bottom-left, gray) |                                                |
| **Telemetry**             | Log \`{ accepted: true/false, edit\_type: "AI"                                                                                                                                                                                                                                                                                         | "Manual", missing\_components, latency\_ms }\` |
| **Copy Updates**          | ‚Ä¢ Tagline stays: *‚ÄúClarity creates impact.‚Äù* <br>‚Ä¢ Skip toast: none <br>‚Ä¢ Accept toast: **‚ÄúHypothesis refined ‚úì‚Äù**                                                                                                                                                                                                                     |                                                |
| **Edge Cases**            | ‚Ä¢ Empty field ‚áí inline error: *‚ÄúAdd a hypothesis to proceed.‚Äù* <br>‚Ä¢ User rejects & still missing components ‚áí highlight missing phrases in red and disable **Next**.                                                                                                                                                                  |                                                |
| **Fail-safe**             | If /ai fails > 2 s ‚Üí dismiss assist, proceed but flag experiment `needs_review=true` for analyst dashboard.                                                                                                                                                                                                                            |                                                |

---

#### **Example Flow**

1. **User types:** ‚ÄúTest new booster mechanic.‚Äù (quality = 0.40)
2. **Modal shows** missing *Metric* & *Direction* and suggests:

   * ‚ÄúPlayers offered the new booster **will have higher D7 retention** than control.‚Äù
   * ‚ÄúNew booster **increases average session length by ‚â• 5 %**.‚Äù
3. User ticks first suggestion ‚Üí textarea updates ‚Üí Score recalculates (now 0.80) ‚Üí **Next** enabled.

This logic guarantees the assist appears for *any* underspecified hypothesis, not just those under 30 characters.
