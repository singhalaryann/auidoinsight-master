# Analytics Platform - Technical Overview

## Overview

This is a full-stack analytics platform designed for product teams to analyze user behavior, run experiments, and make data-driven decisions. The application provides an interactive dashboard for querying analytics data, with Slack integration for natural language analytics questions and automated insights generation.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Styling**: TailwindCSS with shadcn/ui component library
- **State Management**: TanStack Query for server state management
- **Routing**: Wouter for client-side routing
- **Build Tool**: Vite for development and production builds

### Backend Architecture
- **Runtime**: Node.js with Express.js server
- **Language**: TypeScript with ES modules
- **Database**: PostgreSQL with Drizzle ORM
- **Authentication**: Session-based with user profiles
- **Real-time**: WebSocket connections for live dashboard updates

### Database Schema Design
The application uses a comprehensive schema with the following key entities:
- **Users & Profiles**: User management with personalized analytics pillars
- **Questions**: Analytics questions with intent classification and results
- **Experiments**: A/B testing framework with statistical analysis
- **Cohorts**: User segmentation for experiments
- **Metrics & Insights**: Snapshot data for business intelligence
- **Analysis Results**: Detailed statistical analysis with visualizations

## Key Components

### Analytics Question Processing
- **Intent Classification**: OpenAI-powered classification into analytics pillars (engagement, retention, monetization, store, ua, techHealth, social)
- **Clarifying Questions**: Dynamic follow-up questions generated by AI when context is needed
- **Result Storage**: Comprehensive analysis results with statistical metrics and visualizations

### Slack Integration
- **Interactive Modals**: Rich modal-based interface with quick-start options
- **Slash Commands**: `/analyse` command opens guided question entry
- **Real-time Processing**: Questions analyzed and saved to dashboard immediately
- **Fallback Messaging**: Graceful degradation when modals are unavailable

### Experiment Management
- **A/B Testing**: Full experiment lifecycle from setup to statistical analysis
- **Cohort Management**: CSV upload and management for user segmentation
- **Statistical Analysis**: Automated statistical testing with p-values, effect sizes, and confidence intervals

### Business Intelligence
- **Snapshot Metrics**: Real-time KPI tracking with sparkline visualizations
- **AI Insights**: Automated insight generation with detailed analysis breakdowns
- **BigQuery Integration**: Direct connection to Google BigQuery for data queries

## Data Flow

### Question Processing Pipeline
1. User submits question via web interface or Slack
2. OpenAI classifies intent into relevant analytics pillars
3. System generates clarifying questions if needed
4. Question stored in database with user profile updates
5. Real-time dashboard synchronization via WebSocket
6. Background processing generates detailed analysis results

### Experiment Workflow
1. User creates experiment with variants and metrics
2. Cohort file uploaded and validated
3. Experiment deployed with audience targeting
4. Statistical monitoring during experiment runtime
5. Automated analysis and winner determination
6. Results visualization and business recommendations

### Real-time Updates
- WebSocket connections maintain live dashboard state
- Question processing triggers dashboard invalidation
- User profile updates reflect changing analytics focus areas

## External Dependencies

### Required Services
- **PostgreSQL**: Primary database (Neon serverless recommended)
- **OpenAI API**: Intent classification and analysis generation
- **Slack API**: Interactive modal system and messaging
- **Google BigQuery**: Analytics data source (optional)
- **SendGrid**: Email notifications (optional)
- **Replit Object Storage**: File uploads and storage

### Environment Variables
```
DATABASE_URL=postgresql://...
OPENAI_API_KEY=sk-...
SLACK_BOT_TOKEN=xoxb-...
SLACK_SIGNING_SECRET=...
SLACK_CHANNEL_ID=C...
SENDGRID_API_KEY=SG... (optional)
BQ_PROJECT_ID=... (optional)
BQ_PRIVATE_KEY=... (optional)
BQ_CLIENT_EMAIL=... (optional)
```

## Deployment Strategy

### Development Environment
- **Command**: `npm run dev`
- **Features**: Hot module replacement, development middleware, automatic reload
- **Database**: Auto-migration on startup

### Production Deployment
- **Build**: `npm run build` (compiles both client and server)
- **Start**: `npm run start`
- **Target**: Replit autoscale deployment with PostgreSQL module
- **Port**: Application runs on port 5000, externally exposed on port 80

### Database Management
- **ORM**: Drizzle with automatic migrations
- **Schema**: Versioned migrations in `/migrations` directory
- **Seeding**: Sample data available via seed scripts

### Performance Considerations
- Client-side caching with TanStack Query
- Database connection pooling with Neon serverless
- WebSocket connections for real-time features
- File upload handling with multer and object storage

## Changelog
- June 14, 2025. Initial setup
- June 14, 2025. Updated business snapshot page hover functionality to show metric descriptions instead of graphs, added unit display from display_config
- June 14, 2025. Fixed insights display filtering - expanded from top 2 to top 5 user pillars for broader insight coverage
- June 14, 2025. Added two new business insights: "Late-Night Players Show 26% Higher D7 Retention Rate" and "Rising Late-Night Play Share Predicts Early Churn Risk"
- June 14, 2025. Fixed insights ordering to show newest first, updated Python code in booster retention insight with complete BigQuery analysis script
- June 14, 2025. Reinstated "Open Results" card functionality in analytics tab by updating question status to 'ready', allowing users to view completed analysis results
- June 17, 2025. Fixed insight #11 data integrity - replaced fabricated statistical information with authentic analysis results from user notes, fixed null effectSize console errors, removed red badges from Change column in statistical backing tables, added missing SQL query results
- June 17, 2025. Updated insights #6, #7, and #11 overview sections to use cleaner three-section format (Summary/Method/Results) for easier product manager consumption, added missing SQL query results for insight #7
- June 17, 2025. Fixed insight #10 data integrity - replaced fabricated rank tier analysis with authentic rank gain vs retention study, added missing contingency table SQL results, updated overview to Summary/Method/Results format
- June 17, 2025. Updated insight #9 with revised notes - added missing SQL query results, verified all content matches authentic late-night retention analysis, reformatted overview to Summary/Method/Results format
- June 17, 2025. Added interactive charts to business snapshot insights: insight #6 (multi-line chart for booster usage vs playtime), insight #5 (bar chart for retention rates by booster usage), insight #10 (stacked bar chart for rank gain vs retention), and insight #9 (colored bar chart for hourly session distribution plus multi-line retention comparison). Enhanced InsightDetailModal with multi-line, stacked bar, and colored bar chart support including legends and SQL query display
- June 18, 2025. Updated insights #9 and #11 with revised data - insight #9 updated 7-day retention curve with precise values from new analysis, insight #11 updated sample sizes in rank sensitivity chart while maintaining retention rate accuracy
- June 18, 2025. Updated insight #7 with revised booster spending analysis - heavy users reduced from 27,987 to 525 players but with dramatically higher mean spend (£7.53 vs £1.19), updated U statistic and p-value to match new Mann-Whitney test results
- June 18, 2025. Updated insight #6 with revised low-progression player analysis - chart now shows consecutive booster counts (1-19) instead of every-2-boosters, heavy users reduced from 145K to 2.4K sessions, T-statistic updated from 274.12 to 60.70, extended chart to include up to 48 boosters
- June 18, 2025. Updated insight #5 with revised booster retention analysis - heavy users dramatically reduced to 9.4K sessions but with exceptional 65.24% retention vs 19.32% for light users, Z-statistic updated from 138.87 to 111.50

## User Preferences

Preferred communication style: Simple, everyday language.